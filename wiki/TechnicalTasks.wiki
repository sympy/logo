#summary How to work with setup.py

= Introduction =

This wiki describes how to work with setup.py. Help:
{{{
python setup.py --help-commands
}}}
This will print a summary of all commands that `setup.py` understands.

= Cleaning =

To clean the sources (so that `svn st` returns nothing), do 
{{{
python setup.py clean
}}}

= Debian package =

This is how to create a deb package and check that it's correct:

{{{
wajig install docbook2x lintian linda cdbs
}}}

Execute in the root sympy directory:
{{{
python setup.py bdist_dpkg
}}}

This creates these 5 files in /tmp:
{{{
sympy_0.3.orig.tar.gz
sympy_0.3-2_i386.changes
sympy_0.3-2.diff.gz
sympy_0.3-2.dsc
python-sympy_0.3-2_all.deb
}}}

Check it with lintian and linda:
{{{
lintian -i sympy_0.3-2_i386.changes
linda -i sympy_0.3-2_i386.changes
}}}
Nothing should be printed (= lintian&linda clean).

Check it with pbuilder (the create command can be skipped if you alrady did it):
{{{
wajig install pbuilder cdebootstrap
sudo pbuilder create --mirror http://ftp.cz.debian.org/debian
sudo pbuilder update
sudo pbuilder build sympy_0.3-2.dsc
}}}
The sympy source package should build without errors (the build command runs for 3 minutes on my computer). This is to check that the build dependencies are correct. Note: pbuilder works in the directory /var/cache/pbuilder/, so the above commands can be executed anywhere.

Check with piuparts:
{{{
wajig install piuparts
sudo piuparts -p /tmp/python-sympy_0.3-2_all.deb
}}}
The sympy binary package should cleanly install and purge, without leaving any trash behind (again, it takes around 3 minutes on my computer). Note: piuparts work in /tmp, and the `-p` switch tells it to use the pbuilder base image, so it can be executed anywhere.

Check the checklists at:

http://people.debian.org/~neilm/sponsorship.html

http://people.debian.org/~mpalmer/sponsorship_checklist.html

Install it with
{{{
wajig install python-sympy_0.3_all.deb
}}}

Uninstall with
{{{
wajig purge python-sympy
}}}

Upload to http://mentors.debian.net/ with:
{{{
wajig install dupload
dupload -t mentors sympy_0.3-2_i386.changes
}}}

(You need to have `~/.dupload.conf`:
{{{
package config;

$cfg{'mentors'} =
{
   fqdn => 'mentors.debian.net',
   incoming => '/',
   dinstall_runs => 1,
   passive => 1,
};

1;
}}}
)

To update a changelog, use (either in the debian or the root directory):
{{{
dch -v 0.4-pre~svn739
}}}
We'll write a script for that later (just by copying the rules:tarball rule).

More info at:

http://wiki.debian.org/HowToPackageForDebian

= Man page =

The man page is in `doc/man/isympy.1`. To edit it, edit just a file `doc/man/isympy.xml` and then rebuild the debian package. This will update the manpage.