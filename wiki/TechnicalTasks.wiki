#summary How to work with setup.py

= Introduction =

This wiki describes how to work with setup.py. Help:
{{{
./setup.py --help-commands
}}}
This will print a summary of all commands that `setup.py` understands.

= Cleaning =

To clean the sources (so that `svn st` returns nothing), do 
{{{
./setup.py clean
}}}

= Debian package =

This is how to create a deb package and check that it's correct:

{{{
wajig install docbook2x lintian linda cdbs devscripts python-all-dev
}}}

Execute in the sympy root directory:
{{{
./setup.py bdist_dpkg
}}}
This creates the package and related files in `dist/`.

Now execute:
{{{
./setup.py test_dpkg
}}}
This will run lintian, linda, pbuilder and piupart tests. You are done now. However, if you want, you can read some more details below.

Check it with lintian and linda:
{{{
lintian -i dist/sympy_0.4-pre~svn745-1_i386.changes
linda -i dist/sympy_0.4-pre~svn745-1_i386.changes
}}}
Nothing should be printed (= lintian&linda clean).

Check it with pbuilder (the create command can be skipped if you alrady did it):
{{{
wajig install pbuilder cdebootstrap
sudo pbuilder create --mirror http://ftp.cz.debian.org/debian
sudo pbuilder update
sudo pbuilder build dist/sympy_0.4-pre~svn745-1.dsc
}}}
The sympy source package should build without errors (the build command runs for 3 minutes on my computer). This is to check that the build dependencies are correct. Note: pbuilder works in the directory /var/cache/pbuilder/, so don't worry about any trash.

Check with piuparts:
{{{
wajig install piuparts
sudo piuparts -p dist/python-sympy_0.4-pre~svn745-1_all.deb
}}}
The sympy binary package should cleanly install and purge, without leaving any trash behind (again, it takes around 3 minutes on my computer). Note: piuparts work in /tmp, and the `-p` switch tells it to use the pbuilder base image, so again don't worry about any trash.

Check the checklists at:

http://people.debian.org/~neilm/sponsorship.html

http://people.debian.org/~mpalmer/sponsorship_checklist.html

Install it with
{{{
wajig install dist/python-sympy_0.4-pre~svn745-1_all.deb
}}}

Uninstall with
{{{
wajig purge python-sympy
}}}

Upload to http://mentors.debian.net/ with:
{{{
wajig install dupload
dupload dist/sympy_0.4-pre~svn745-1_i386.changes
}}}

(You need to have `~/.dupload.conf`:
{{{
package config;

$default_host = 'mentors';

$cfg{'mentors'} =
{
   fqdn => 'mentors.debian.net',
   incoming => '/',
   dinstall_runs => 1,
   passive => 1,
};

1;
}}}
)

To download and unpack the source package (and test it):
{{{
dget -x http://mentors.debian.net/debian/pool/main/s/sympy/sympy_0.4-pre+svn765-1.dsc
cd sympy-0.4~pre+svn780
debuild
cd ..
lintian -i *.changes
linda -i *.changes
sudo pbuilder build *.dsc
sudo piuparts -p *.deb
}}}

To update a changelog, use (either in the debian or the root directory):
{{{
dch -v 0.4-pre~svn739
}}}
We'll write a script for that later (just by copying the rules:tarball rule).

More info at:

http://wiki.debian.org/HowToPackageForDebian

= Man page =

The man page is in `doc/man/isympy.1`, and it is generated from the file `doc/man/isympy.xml`. To edit it, edit just the file `doc/man/isympy.xml` and then rebuild the man page with

{{{
  docbook2x-man doc/man/isympy.xml
  mv isympy.1 doc/man/isympy.1
}}}


= Generating the (html) documentation for the api =

you'll need epydoc. The output is written to ../api/ (you can change this editing the variable gen_doc.target_dir )

{{{
  python setup.py gen_doc
}}}

= How to make a new release =

Create a new branch:

{{{
svn checkout https://sympy.googlecode.com/svn/ sympy --username ondrej.certik
cd sympy
svn copy trunk tags/sympy-0.4
}}}

Then in this branch:

  * create sympy-x.y.tar.gz file every time we release a new version (without the debian dir inside), using `./setup.py sdist`
  * put it on the website
  * mv sympy-x.y.tar.gz sympy_x.y.orig.tar.gz
  * `dch -v x.y-1 -m "New upstream release"`
  * debuild

and possibly merge the changes in the debian/ directory with the trunk.